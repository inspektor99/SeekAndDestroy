/*! SeekAndDestroy 2014-04-23 */
!function(){window.console||alert("your browser sucks and cannot run this site"),window.WebSocket||alert("again, your browser sucks and cannot run this awesome site.  we will now spam your browser with errors. prepare to die.")}();var Sad={TARGET_COUNT:4,TIME_WARNING:6e3,TIME_DANGER:9e3,TIME_LIMIT:12e3,currentTeam:null,teams:[]};$(function(){var a=io.connect("http://localhost:3000");$("#statusGameServer").tooltip({placement:"bottom"}),$("#resetAll").tooltip({placement:"bottom"});var b=function(){$.get("/connect?ip="+$("#raspPiAddress").val())};$("#resetAll").on("click",function(){return $.get("/reset"),!1}),$("#statusGameServer").on("click",function(){return b(),!1}),$("#generalSetup").on("click",function(){return $("#generalSetupWindow").modal(),!1}),$("#piConnect").on("click",function(){return $("#generalSetupWindow").modal("hide"),b(),!1}),a.on("connectedrpi",function(){$("#statusGameServer").removeClass("btn-default btn-success btn-danger btn-warning").addClass("btn-success")}),a.on("connecterror",function(){$("#statusGameServer").removeClass("btn-default btn-success btn-danger btn-warning").addClass("btn-danger"),c()}),a.on("startgame",function(a){$("#timer").removeClass("text-warning"),$("#timer").removeClass("text-error"),$("#timer").addClass("text-info");var b=new Sad.Team;b.set("name",a.teamname),Sad.addTeam(b),b=Sad.setCurrentTeam(a.teamname),b.addNewGame(a.gamename,a.targets),$("#currteam").text(Sad.currentTeam.get("name")),$("#currgame").text(a.gamename);var c=Sad.currentTeam.getCurrentGame();return Sad.updateTargets(a.targets),c.set("start",(new Date).getTime()),$("#welcome").hide(),$("#scoreboard").slideDown("slow"),Sad.Timer.start(),$("#music")[0].volume=.2,$("#music")[0].play(),!1}),a.on("targethit",function(a){if($("#scoreboard").is(":visible")){Sad.playBomb(),Sad.updateTargets(a.targets);var b=Sad.currentTeam.getCurrentGame();$("#t1_type, #t2_type, #t3_type, #t4_type").removeClass(),$("#t1_type, #t2_type, #t3_type, #t4_type").addClass("muted"),_.each(b.get("targets"),function(a){var b=$("#teamScore").text();b=parseFloat(b),console.log("UI Score:     "+b),console.log("Target Score: "+a.get("points")),b+=parseFloat(a.get("points")),$("#teamScore").text(b),$("#t"+a.get("id")+"_hit").val(a.get("hit"));var c=$("#t"+a.get("id")+"_type");c.removeClass();var d=a.get("status");1===d?c.addClass("text-success"):0===d?c.addClass("text-error"):2===d&&c.addClass("muted")})}}),a.on("stopgame",function(){var a=Sad.currentTeam.getCurrentGame();return null!==a&&(a.set("score",parseInt($("#teamScore").text())),$("#finalscorewindow").modal(),Sad.Timer.stop(),a.set("end",(new Date).getTime()),$("#music")[0].pause(),$("#music")[0].currentTime=0,a.set("endDisplay",$("#timer").text()),$("#resultTeamName").html(Sad.currentTeam.get("name")),$("#inputTime").val(a.get("endDisplay")),$("#inputFinalscore").val(a.get("score")),$("#inputGamenotesEnd").val(a.get("notes"))),!1});var c=function(){if($("#music")[0].pause(),$("#music")[0].currentTime=0,Sad.Timer.reset(),$("#scoreboard").hide(),$("#welcome").slideDown("slow"),$("#finalscorewindow").modal("hide"),$("#teamScore").html("0"),null!==Sad.currentTeam){var a=Sad.currentTeam.getCurrentGame();_.each(a.get("targets"),function(a){$("#t"+a.get("id")+"_hit").val("0");var b=$("#t"+a.get("id")+"_type");b.removeClass(),b.addClass("muted")})}};a.on("reset",function(){c()}),$("#finish").on("click",function(){c();var a=Sad.currentTeam.getCurrentGame();_.each(a.get("targets"),function(a){var b=$("#t"+a.get("id")+"_hit").val();a.set("hit",parseInt(b))});var b=$("#inputFinalscore").val();return a.set("score",parseInt(b)),a.set("notes",$("#inputGamenotesEnd").val()),!1})}),Sad.playBomb=function(){$("#bomb")[0].volume=1,$("#bomb")[0].pause(),$("#bomb")[0].currentTime=0,$("#bomb")[0].play()},Sad.loadStats=function(a){var b=0,c=this.teams.length;for($("tbody",a).html(""),b=0;c>b;b++){var d=this.teams[b].toJSON();$("tbody",a).append("<tr><td></td><td>"+d.name+"</td><td>"+d.games.length+"</td><td></td></tr>")}},Sad.updateTargets=function(a){var b=Sad.currentTeam.getCurrentGame();b.setTargets(a),$("#t1_counter, #t2_counter, #t3_counter, #t4_counter").removeClass(),$("#t1_counter, #t2_counter, #t3_counter, #t4_counter").addClass("badge"),$("#t1_counter>span, #t2_counter>span, #t3_counter>span, #t4_counter>span").text("X"),_.each(b.get("targets"),function(a){var b=$("#t"+a.get("id")+"_counter");$("span",b).text(a.get("hit"));var c=a.get("status");b.removeClass(),1===c?b.addClass("badge badge-success"):0===c?b.addClass("badge badge-important"):2===c&&b.addClass("badge")})},Sad.Target=Backbone.Model.extend({defaults:{id:0,status:2,hit:0}}),Sad.addTeam=function(a){var b=!0;return _.each(this.teams,function(c){c.get("name").toLowerCase()===a.get("name").toLowerCase()&&(b=!1)}),b&&(a.set("games",[]),this.teams.push(a)),b},Sad.setCurrentTeam=function(a){var b=null;return _.each(this.teams,function(c){c.get("name").toLowerCase()===a.toLowerCase()&&(Sad.currentTeam=c,b=c)}),b},Sad.Team=Backbone.Model.extend({defaults:{name:null,ip:null,score:0,games:[]},addNewGame:function(a,b){var c=new Sad.Game;return c.set("code",a),c.setTargets(b),this.get("games").push(c),c},getCurrentGame:function(){return this.get("games")[this.get("games").length-1]}}),Sad.Game=Backbone.Model.extend({defaults:{code:null,start:0,end:0,endDisplay:"0:00:00",targets:null,score:0,notes:null},setTargets:function(a){this.set("targets",[]);var b=0;for(b=0;b<a.length;b++){var c=new Sad.Target;c.set(a[b]),this.get("targets").push(c)}}}),Sad.Timer={DEFAULT_DISPLAY:"0:00:000",id:null,tick:0,elem:$("#timer")[0],isRunning:function(){return null!==this.id},start:function(){this.id=window.setInterval(this.setTick,10)},setTick:function(){Sad.Timer.tick++;var a=Sad.Timer.tick%100,b=Math.floor(Sad.Timer.tick/100),c=Math.floor(b/60);b%=60,10>a&&(a="0"+a.toString()),10>b&&(b="0"+b.toString()),Sad.Timer.elem.innerHTML=c+":"+b+":"+a,Sad.Timer.tick===Sad.TIME_WARNING&&($("#timer").removeClass("text-info"),$("#timer").addClass("text-warning")),Sad.Timer.tick===Sad.TIME_DANGER&&($("#timer").removeClass("text-warning"),$("#timer").addClass("text-danger")),Sad.Timer.tick===Sad.TIME_LIMIT&&Sad.Timer.stop()},stop:function(){null!==Sad.Timer.id&&(window.clearInterval(Sad.Timer.id),Sad.Timer.id=null)},reset:function(){Sad.Timer.stop(),Sad.Timer.tick=0,Sad.Timer.elem.innerHTML=Sad.Timer.DEFAULT_DISPLAY},getTick:function(){return this.tick}};